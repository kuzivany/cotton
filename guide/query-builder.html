<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Query Builder | Cotton</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="SQL Database Toolkit for Deno">
    
    <link rel="preload" href="/cotton/assets/css/0.styles.65b05811.css" as="style"><link rel="preload" href="/cotton/assets/js/app.c3ef63be.js" as="script"><link rel="preload" href="/cotton/assets/js/2.ed1de254.js" as="script"><link rel="preload" href="/cotton/assets/js/12.053ac066.js" as="script"><link rel="prefetch" href="/cotton/assets/js/10.fec31158.js"><link rel="prefetch" href="/cotton/assets/js/11.557103ec.js"><link rel="prefetch" href="/cotton/assets/js/13.097ae9f1.js"><link rel="prefetch" href="/cotton/assets/js/14.d9d91aa1.js"><link rel="prefetch" href="/cotton/assets/js/15.7bb82672.js"><link rel="prefetch" href="/cotton/assets/js/16.a8f3accd.js"><link rel="prefetch" href="/cotton/assets/js/17.6cc49af8.js"><link rel="prefetch" href="/cotton/assets/js/18.9b15b555.js"><link rel="prefetch" href="/cotton/assets/js/19.79a0dd2f.js"><link rel="prefetch" href="/cotton/assets/js/20.72320857.js"><link rel="prefetch" href="/cotton/assets/js/21.5a3cb36f.js"><link rel="prefetch" href="/cotton/assets/js/22.80c435fb.js"><link rel="prefetch" href="/cotton/assets/js/3.685e1241.js"><link rel="prefetch" href="/cotton/assets/js/4.be90e835.js"><link rel="prefetch" href="/cotton/assets/js/5.62e57111.js"><link rel="prefetch" href="/cotton/assets/js/6.12d0107c.js"><link rel="prefetch" href="/cotton/assets/js/7.ab30ef48.js"><link rel="prefetch" href="/cotton/assets/js/8.2f476a38.js"><link rel="prefetch" href="/cotton/assets/js/9.e169cddd.js">
    <link rel="stylesheet" href="/cotton/assets/css/0.styles.65b05811.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cotton/" class="home-link router-link-active"><!----> <span class="site-name">Cotton</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cotton/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/cotton/guide/" class="nav-link router-link-active">
  Guides
</a></div><div class="nav-item"><a href="https://github.com/rahmanfadhil/cotton" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cotton/guide/query-builder.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/cotton/zh/guide/query-builder.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cotton/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/cotton/guide/" class="nav-link router-link-active">
  Guides
</a></div><div class="nav-item"><a href="https://github.com/rahmanfadhil/cotton" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cotton/guide/query-builder.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/cotton/zh/guide/query-builder.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cotton/guide/connection.html" class="sidebar-link">Connection</a></li><li><a href="/cotton/guide/query-builder.html" aria-current="page" class="active sidebar-link">Query Builder</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#where" class="sidebar-link">WHERE</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#select" class="sidebar-link">SELECT</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#group-by-having" class="sidebar-link">GROUP BY &amp; HAVING</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#order" class="sidebar-link">ORDER</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#count" class="sidebar-link">COUNT</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#offset-limit" class="sidebar-link">OFFSET &amp; LIMIT</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#insert-replace" class="sidebar-link">INSERT / REPLACE</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#update" class="sidebar-link">UPDATE</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#delete" class="sidebar-link">DELETE</a></li><li class="sidebar-sub-header"><a href="/cotton/guide/query-builder.html#returning" class="sidebar-link">RETURNING</a></li></ul></li><li><a href="/cotton/guide/transactions.html" class="sidebar-link">Transactions</a></li><li><a href="/cotton/guide/model.html" class="sidebar-link">Models</a></li><li><a href="/cotton/guide/migrations.html" class="sidebar-link">Migrations</a></li><li><a href="/cotton/guide/schema.html" class="sidebar-link">Schema</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="query-builder"><a href="#query-builder" class="header-anchor">#</a> Query Builder</h1> <p>Cotton offers a simple, powerful, and database agnostic query builder. It allows you to construct SQL queries with ease.</p> <p>Once you have established a connection, you can now use the query builder via <code>table</code> method.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;sqlite&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// other options...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SELECT * FROM `users`;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { id: 1, email: 'a@b.com', ... }</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>table</code> methods takes only one argument, which is the name of the table you want to fetch. This method returns a <code>QueryBuilder</code> instance, which contains more methods to construct your query. You can chain all these methods you need in order to add more constraints or statements.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// SELECT * FROM `users` WHERE `id` = ?;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As you can see, the values are replaced with a placeholder in the query string and being handled by the database to prevent SQL injection.</p> <p>If you just want to get the SQL query string and don't want run the it, you can end the statement with <code>toSQL</code> instead of <code>execute</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> text<span class="token punctuation">,</span> values <span class="token punctuation">}</span> <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toSQL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;SELECT * FROM `users` WHERE `id` = ?;&quot;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1]</span>
</code></pre></div><h2 id="where"><a href="#where" class="header-anchor">#</a> WHERE</h2> <p>One of the most common thing people do in SQL query is using <code>WHERE</code> clause to filter the result.</p> <p>Filtering records through <code>WHERE</code> clause is one of the most common thing people do with SQL query. In Cotton, you can easily add where clause of any kind by simply using <code>where</code> method.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The first parameter is the column name, and the second is the expected value. By default, it will use the <code>=</code> operator which will check whether the value is equal. You can customize the query operator by using <code>Q</code> helper to customize the SQL expressions.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SELECT * FROM `users` WHERE `id` &gt; 1;</span>
db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token keyword">in</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SELECT * FROM `users` WHERE `id` IN (1, 2, 3);</span>
db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SELECT * FROM `users` WHERE `id` BETWEEN 1 AND 5</span>
</code></pre></div><p>These are the valid expressions you can access through <code>Q</code> utility.</p> <table><thead><tr><th>Syntax</th> <th>SQL Equivalent</th> <th>Description</th></tr></thead> <tbody><tr><td><code>Q.in([1, 2, 3])</code></td> <td><code>IN</code></td> <td>The value is one of the given values</td></tr> <tr><td><code>Q.notIn([1, 2, 3])</code></td> <td><code>NOT IN</code></td> <td>The value is not one of the given values</td></tr> <tr><td><code>Q.between(5, 10)</code></td> <td><code>BETWEEN</code></td> <td>The value (number) is between two numbers</td></tr> <tr><td><code>Q.notBetween(5, 10)</code></td> <td><code>NOT BETWEEN</code></td> <td>The value (number) is between two numbers</td></tr> <tr><td><code>Q.like('%john%')</code></td> <td><code>LIKE</code></td> <td>LIKE operator</td></tr> <tr><td><code>Q.notLike('%john%')</code></td> <td><code>NOT LIKE</code></td> <td>NOT LIKE operator</td></tr> <tr><td><code>Q.ilike('%john%')</code></td> <td><code>ILIKE</code></td> <td>ILIKE (case-insensitive) operator</td></tr> <tr><td><code>Q.notIlike('%john%')</code></td> <td><code>NOT ILIKE</code></td> <td>NOT ILIKE (case-insensitive) operator</td></tr> <tr><td><code>Q.eq('a@b.com')</code></td> <td><code>=</code></td> <td>Is equal to</td></tr> <tr><td><code>Q.neq('a@b.com')</code></td> <td><code>!=</code></td> <td>Is not equal to</td></tr> <tr><td><code>Q.gt(7)</code></td> <td><code>&gt;</code></td> <td>Greater than</td></tr> <tr><td><code>Q.gte(7)</code></td> <td><code>&gt;=</code></td> <td>Greater than equal</td></tr> <tr><td><code>Q.lt(7)</code></td> <td><code>&lt;</code></td> <td>Lower than</td></tr> <tr><td><code>Q.lte(7)</code></td> <td><code>&lt;=</code></td> <td>Lower than equal</td></tr> <tr><td><code>Q.null()</code></td> <td><code>IS NULL</code></td> <td>Is the value null</td></tr> <tr><td><code>Q.notNull()</code></td> <td><code>IS NOT NULL</code></td> <td>Is the value not null</td></tr></tbody></table> <p>Currently, the valid values are <code>boolean</code>, <code>string</code>, <code>null</code>, <code>number</code>, and <code>Date</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>query
  <span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a@b.com&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;birthday&quot;</span><span class="token punctuation">,</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&quot;7 July, 2020&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sometimes you want to exclude or some records that match given conditions. For that, you can use <code>not</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>query<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or, if you want to find records if one of the conditions are true, use <code>or</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>query<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jane&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h2> <p>By default, query builder will select every single columns in the table with <code>*</code>. However, you can choose which columsnt to select in a query by calling <code>select</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To select multiple columns, you can either pass multiple strings to the parameter or chain it multiple times.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;is_active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Alternatively...</span>
db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to select only unique values, you can enable distinct select by using <code>distinct</code> method.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="group-by-having"><a href="#group-by-having" class="header-anchor">#</a> GROUP BY &amp; HAVING</h2> <p>Adding a <code>GROUP BY</code> query can be done by using <code>groupBy</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token string">&quot;users.category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// explicit table name</span>
</code></pre></div><p>Most of the time, <code>GROUP BY</code> expressions are paired with <code>HAVING</code> to filter the records, and here is how you can do that:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">having</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="order"><a href="#order" class="header-anchor">#</a> ORDER</h2> <p>You can sort a column using <code>order</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default this will sort in ascending order. You can change this by passing the second parameter.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DESC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or ASC</span>
</code></pre></div><p>To sort multiple column, you can chain this method as many as you want.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DESC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">&quot;created_at&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="count"><a href="#count" class="header-anchor">#</a> COUNT</h2> <p>You can count how many records that match given conditions by using the <code>count</code> method.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Count multiple columns by passing an array as the argument.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;is_banned&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To specify an alias for the count result, you can pass the second parameter.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Use <code>countDistinct</code> to add distinct expression inside your count statement.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">countDistinct</span><span class="token punctuation">(</span><span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="offset-limit"><a href="#offset-limit" class="header-anchor">#</a> OFFSET &amp; LIMIT</h2> <p>Typically, pagination can be done in SQL by using limit and offset. Limit is the maximum number of record to return, and the offset is the number of records to skip. Here is an example.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="insert-replace"><a href="#insert-replace" class="header-anchor">#</a> INSERT / REPLACE</h2> <p>To insert a new record, use <code>insert</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;a@b.com&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To insert multiple records in a single query, you can pass an array instead.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;a@b.com&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;b@c.com&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">17</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;c@d.com&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Another way to insert a record is by using replace. It will look for <code>PRIMARY</code> and <code>UNIQUE</code> constraints. If something matched, it gets removed from the table and creates a new row with the given values.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;a@b.com&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;a@b.com&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="update"><a href="#update" class="header-anchor">#</a> UPDATE</h2> <p>To perform update, you need to chain <code>update</code> method and pass the values you want to update. The value parameter is a key-value pair which represents the column name and it's value. This method can be chained with other constraints such as <code>where</code>, <code>not</code>, <code>or</code>, <code>limit</code>, etc.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;a@b.com&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="delete"><a href="#delete" class="header-anchor">#</a> DELETE</h2> <p>The only thing you need to do to perform DELETE query is by adding <code>delete</code> method to the query builder.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="returning"><a href="#returning" class="header-anchor">#</a> RETURNING</h2> <p>Returning is a statement that typically used in INSERT or REPLACE query. Note that this feature only works in PostgreSQL. However, you can still build this query in MySQL or SQLite connection.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token string">&quot;a@b.com&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returning</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cotton/guide/connection.html" class="prev">
        Connection
      </a></span> <span class="next"><a href="/cotton/guide/transactions.html">
        Transactions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/cotton/assets/js/app.c3ef63be.js" defer></script><script src="/cotton/assets/js/2.ed1de254.js" defer></script><script src="/cotton/assets/js/12.053ac066.js" defer></script>
  </body>
</html>
